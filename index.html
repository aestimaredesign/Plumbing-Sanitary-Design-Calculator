<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Plumbing & Sanitary Design Calculator</title>

<!-- jsPDF and autotable for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<!-- SheetJS for Excel export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root{
  --primary:#2563eb;
  --primary-dark:#1d4ed8;
  --secondary:#64748b;
  --light:#f8fafc;
  --dark:#0f172a;
  --success:#10b981;
  --warning:#f59e0b;
  --danger:#ef4444;
  --border:#cbd5c1;
}
body{font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif;background:#f1f5f9;color:var(--dark);padding:20px}
.container{max-width:1200px;margin:0 auto}
header{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;padding:20px;border-radius:10px;margin-bottom:20px}
h1{font-size:1.8rem;margin:0}
.subtitle{opacity:.9;margin-top:6px}
.disclaimer{background:#fff3cd;border:1px solid #ffeaa7;padding:10px;border-radius:6px;margin-top:10px;color:#000}
.tabs{display:flex;border-bottom:1px solid var(--border);gap:6px;flex-wrap:wrap;margin-bottom:12px}
.tab{padding:8px 14px;cursor:pointer;border-bottom:3px solid transparent}
.tab.active{border-bottom:3px solid var(--primary);font-weight:600;color:var(--primary)}
.tab-content{display:none}
.tab-content.active{display:block}
.section{background:#fff;padding:18px;border-radius:8px;border:1px solid var(--border);margin-bottom:18px}
.form-row{display:flex;align-items:center;margin-bottom:12px;gap:12px;flex-wrap:wrap}
.form-row label{flex:0 0 190px;font-weight:600;text-align:right}
.input-group{flex:1;display:flex;gap:8px;align-items:center}
.input-group input,.input-group select{flex:1;padding:8px;border-radius:6px;border:1px solid var(--border);min-width:0}
.unit{flex:0 0 70px;font-weight:600}
.button-group{display:flex;gap:10px;margin-top:10px}
button{padding:10px 14px;border-radius:6px;border:none;background:var(--primary);color:#fff;cursor:pointer}
button.secondary{background:var(--secondary)}
.output{margin-top:12px;padding:12px;border-radius:6px;background:#f8fafe;border-left:4px solid var(--primary);display:none}
.reference-table{width:100%;border-collapse:collapse;margin-top:10px}
.reference-table th,.reference-table td{padding:8px;border:1px solid #ddd}
.formula{font-family:monospace;background:#f8fafc;padding:8px;border-radius:6px;border-left:3px solid var(--primary)}
.grey-header{background:#e0e0e0;font-weight:bold}
.hidden-file{display:none}

/* Design Calculator Specific Styles */
.calculator-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px;margin-bottom:16px}
.calc-section{margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid #eee}
.calc-section:last-child{border-bottom:none}
.code-reference{font-size:0.85em;color:var(--secondary);font-style:italic;margin-top:5px}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Plumbing & Sanitary Design Calculator</h1>
    <div class="subtitle">Professional design tools for plumbing engineers — pipe sizing, pump selection, and system design</div>
    <div class="disclaimer">
      <strong>Note:</strong> These are enhanced engineering tools for professional preliminary design and analysis. For construction/permit use, validate with local codes and a licensed engineer.
    </div>
  </header>

  <div class="tabs">
    <div class="tab active" data-tab="project">Project Info</div>
    <div class="tab" data-tab="water-design">Water System Design</div>
    <div class="tab" data-tab="drainage">Drainage & Sanitary</div>
    <div class="tab" data-tab="pumps">Pump Systems</div>
    <div class="tab" data-tab="special-systems">Special Systems & Reference</div>
  </div>

  <!-- Project Info -->
  <div id="project" class="tab-content active">
    <div class="section">
      <h2>Project Information</h2>
      <div class="form-row">
        <label>Project Name:</label>
        <div class="input-group"><input id="projectName" type="text" value="Commercial Building Plumbing Design"></div>
      </div>
      <div class="form-row">
        <label>Client Name:</label>
        <div class="input-group"><input id="clientName" type="text" value="ABC Development Corporation"></div>
      </div>
      <div class="form-row">
        <label>Location:</label>
        <div class="input-group"><input id="projectLocation" type="text" value="Manila, Philippines"></div>
      </div>
      <div class="form-row">
        <label>Prepared By:</label>
        <div class="input-group"><input id="preparedBy" type="text" value="Juan Dela Cruz, Plumbing Engineer"></div>
      </div>
      <div class="form-row">
        <label>Currency:</label>
        <div class="input-group">
          <select id="currency"><option value="PHP">Philippine Peso (₱)</option><option value="USD">US Dollar ($)</option><option value="EUR">Euro (€)</option><option value="JPY">Yen (¥)</option></select>
        </div>
      </div>
      <div class="form-row">
        <label>Plumbing Code Standard:</label>
        <div class="input-group">
          <select id="codeStandard"><option value="rnpcp">RNPCP 2021 (Philippines)</option><option value="ipc">IPC 2024</option><option value="upc">UPC 2024</option></select>
        </div>
      </div>
      <div class="form-row">
        <label>Measurement Units:</label>
        <div class="input-group">
          <select id="units"><option value="metric">Metric (m, L/s)</option><option value="imperial">Imperial (ft, gpm)</option></select>
        </div>
      </div>

      <div class="button-group">
        <button onclick="saveProjectAsJSON()">Save Project (JSON)</button>
        <button class="secondary" onclick="document.getElementById('jsonFileInput').click()">Load Project (JSON)</button>
        <input id="jsonFileInput" type="file" accept=".json,application/json" class="hidden-file" onchange="loadProjectFromJSON(event)">
        <button class="secondary" onclick="resetCalculator()" style="background-color:var(--danger)">Reset</button>
      </div>
    </div>
  </div>

  <!-- Water System Design -->
  <div id="water-design" class="tab-content">
    <div class="section">
      <h2>Water System Design Tools</h2>
      
      <div class="calculator-grid">
        <!-- Water Supply & Pipe Sizing -->
        <div class="calc-section">
          <h3>Water Supply & Pipe Sizing</h3>
          <p class="code-reference">Reference: IPC Appendix E; RNPCP 2021 Section 611</p>
          
          <div class="form-row">
            <label>Total Fixture Units:</label>
            <div class="input-group">
              <select id="waterFixtureUnitsCode">
                <option value="ipc">IPC 2024</option>
                <option value="rnpcp">RNPCP 2021</option>
              </select>
              <input id="waterFixtureUnits" type="number" min="0" value="50">
            </div>
          </div>
          
          <div class="form-row">
            <label>Peak Factor (0.5-1.0):</label>
            <div class="input-group">
              <input id="waterPeakFactor" type="number" step="0.1" min="0.5" max="1.0" value="0.7">
            </div>
          </div>
          
          <div class="form-row">
            <label>Supply Pressure (m):</label>
            <div class="input-group">
              <input id="waterSupplyPressure" type="number" min="0" value="30">
              <div class="unit">m</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Min Fixture Pressure:</label>
            <div class="input-group">
              <input id="waterMinPressure" type="number" min="0" value="15">
              <div class="unit">psi</div>
            </div>
          </div>
          
          <button onclick="calculateWaterSupply()">Calculate Flow & Pipe Size</button>
          <div id="waterSupplyOutput" class="output"></div>
        </div>

        <!-- Water Tank & Reservoir Sizing -->
        <div class="calc-section">
          <h3>Water Tank & Reservoir Sizing</h3>
          <p class="code-reference">Reference: IPC Section 607.2; RNPCP 2021 Section 603</p>
          
          <div class="form-row">
            <label>Population Served:</label>
            <div class="input-group">
              <input id="tankPopulation" type="number" min="0" value="100">
              <div class="unit">people</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Daily Demand:</label>
            <div class="input-group">
              <input id="tankDailyDemand" type="number" min="0" value="180">
              <div class="unit">L/day</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Emergency Days:</label>
            <div class="input-group">
              <input id="tankEmergencyDays" type="number" min="0" value="2">
              <div class="unit">days</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Fire Reserve:</label>
            <div class="input-group">
              <input id="tankFireReserve" type="number" min="0" value="5000">
              <div class="unit">L</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Equalization (%):</label>
            <div class="input-group">
              <input id="tankEqualization" type="number" min="0" max="100" value="20">
              <div class="unit">%</div>
            </div>
          </div>
          
          <button onclick="calculateTankSize()">Calculate Tank Size</button>
          <div id="tankSizeOutput" class="output"></div>
        </div>

        <!-- Booster Pump Sizing -->
        <div class="calc-section">
          <h3>Booster Pump Sizing</h3>
          <p class="code-reference">Reference: IPC Section 604.3; RNPCP 2021 Section 612</p>
          
          <div class="form-row">
            <label>Required Flow:</label>
            <div class="input-group">
              <input id="pumpFlow" type="number" min="0" value="5">
              <div class="unit">L/s</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Elevation Difference:</label>
            <div class="input-group">
              <input id="pumpElevation" type="number" value="15">
              <div class="unit">m</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Friction Loss:</label>
            <div class="input-group">
              <input id="pumpFriction" type="number" min="0" value="8">
              <div class="unit">m</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Safety Margin:</label>
            <div class="input-group">
              <input id="pumpSafety" type="number" min="0" max="100" value="15">
              <div class="unit">%</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Pump Efficiency:</label>
            <div class="input-group">
              <input id="pumpEfficiency" type="number" min="0" max="100" value="75">
              <div class="unit">%</div>
            </div>
          </div>
          
          <button onclick="calculateBoosterPump()">Calculate Pump TDH & Power</button>
          <div id="boosterPumpOutput" class="output"></div>
        </div>

        <!-- Hot Water System Demand -->
        <div class="calc-section">
          <h3>Hot Water System Demand</h3>
          <p class="code-reference">Reference: IPC Section 607.10; RNPCP 2021 Section 607</p>
          
          <div class="form-row">
            <label>Number of Bathrooms:</label>
            <div class="input-group">
              <input id="hotWaterBathrooms" type="number" min="0" value="10">
            </div>
          </div>
          
          <div class="form-row">
            <label>Simultaneous Use:</label>
            <div class="input-group">
              <input id="hotWaterSimultaneous" type="number" min="0" max="100" value="15">
              <div class="unit">%</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Hot Fraction:</label>
            <div class="input-group">
              <input id="hotWaterFraction" type="number" step="0.01" min="0" max="1" value="0.6">
            </div>
          </div>
          
          <button onclick="calculateHotWaterDemand()">Calculate Peak Hot Flow</button>
          <div id="hotWaterOutput" class="output"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Drainage & Sanitary -->
  <div id="drainage" class="tab-content">
    <div class="section">
      <h2>Drainage & Sanitary System Design</h2>
      
      <div class="calculator-grid">
        <!-- Sanitary Sewer Load -->
        <div class="calc-section">
          <h3>Sanitary Sewer Load Calculation</h3>
          <p class="code-reference">Reference: IPC Section 709; RNPCP 2021 Section 701</p>
          
          <div class="form-row">
            <label>Population Served:</label>
            <div class="input-group">
              <input id="sewerPopulation" type="number" min="0" value="100">
              <div class="unit">people</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Wastewater per Capita:</label>
            <div class="input-group">
              <input id="sewerPerCapita" type="number" min="0" value="120">
              <div class="unit">L/day</div>
            </div>
          </div>
          
          <button onclick="calculateSewerLoad()">Calculate Daily Flow</button>
          <div id="sewerLoadOutput" class="output"></div>
          
          <h4>Fixture Unit to Flow Conversion</h4>
          <div class="form-row">
            <label>Total DFU:</label>
            <div class="input-group">
              <input id="sewerDFU" type="number" min="0" value="85">
            </div>
          </div>
          
          <button onclick="calculateDFUFlow()">Calculate Peak Flow from DFU</button>
          <div id="dfuFlowOutput" class="output"></div>
        </div>

        <!-- Storm Drainage -->
        <div class="calc-section">
          <h3>Storm Drainage — Rational Method</h3>
          <p class="code-reference">Reference: IPC Section 1106.2; RNPCP 2021 Section 1102</p>
          
          <div class="form-row">
            <label>Runoff Coefficient:</label>
            <div class="input-group">
              <input id="stormCoefficient" type="number" step="0.01" min="0" max="1" value="0.8">
            </div>
          </div>
          
          <div class="form-row">
            <label>Rain Intensity:</label>
            <div class="input-group">
              <input id="stormIntensity" type="number" min="0" value="120">
              <div class="unit">mm/hr</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Area:</label>
            <div class="input-group">
              <input id="stormArea" type="number" min="0" value="500">
              <div class="unit">m²</div>
            </div>
          </div>
          
          <button onclick="calculateStormFlow()">Calculate Peak Flow</button>
          <div id="stormFlowOutput" class="output"></div>
        </div>

        <!-- Septic Tank Sizing -->
        <div class="calc-section">
          <h3>Septic Tank Sizing</h3>
          <p class="code-reference">Reference: IPC Appendix B; RNPCP 2021 & DOH Standards</p>
          
          <div class="form-row">
            <label>Daily Flow:</label>
            <div class="input-group">
              <input id="septicDailyFlow" type="number" min="0" value="12000">
              <div class="unit">L/day</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Retention Time:</label>
            <div class="input-group">
              <input id="septicRetention" type="number" min="0" value="36">
              <div class="unit">hrs</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Freeboard Allowance:</label>
            <div class="input-group">
              <input id="septicFreeboard" type="number" min="0" max="100" value="20">
              <div class="unit">%</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Compartments:</label>
            <div class="input-group">
              <input id="septicCompartments" type="number" min="1" value="2">
            </div>
          </div>
          
          <button onclick="calculateSepticTank()">Calculate Septic Volume</button>
          <div id="septicTankOutput" class="output"></div>
        </div>

        <!-- Grease Trap Sizing -->
        <div class="calc-section">
          <h3>Grease Trap Sizing</h3>
          <p class="code-reference">Reference: IPC Section 1003.4; RNPCP 2021 Section 1011</p>
          
          <div class="form-row">
            <label>Peak Flow:</label>
            <div class="input-group">
              <input id="greasePeakFlow" type="number" min="0" value="2">
              <div class="unit">L/s</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Retention Time:</label>
            <div class="input-group">
              <input id="greaseRetention" type="number" min="0" value="25">
              <div class="unit">min</div>
            </div>
          </div>
          
          <button onclick="calculateGreaseTrap()">Calculate Grease Volume</button>
          <div id="greaseTrapOutput" class="output"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pump Systems -->
  <div id="pumps" class="tab-content">
    <div class="section">
      <h2>Pump System Design</h2>
      
      <div class="calculator-grid">
        <!-- Transfer Pump Sizing -->
        <div class="calc-section">
          <h3>Transfer Pump Sizing</h3>
          
          <div class="form-row">
            <label>Required Flow:</label>
            <div class="input-group">
              <input id="transferFlow" type="number" min="0" value="8">
              <div class="unit">L/s</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Static Lift:</label>
            <div class="input-group">
              <input id="transferLift" type="number" value="12">
              <div class="unit">m</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Friction Loss:</label>
            <div class="input-group">
              <input id="transferFriction" type="number" min="0" value="5">
              <div class="unit">m</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Efficiency:</label>
            <div class="input-group">
              <input id="transferEfficiency" type="number" min="0" max="100" value="75">
              <div class="unit">%</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Safety Margin:</label>
            <div class="input-group">
              <input id="transferSafety" type="number" min="0" max="100" value="10">
              <div class="unit">%</div>
            </div>
          </div>
          
          <button onclick="calculateTransferPump()">Calculate Pump Power</button>
          <div id="transferPumpOutput" class="output"></div>
        </div>

        <!-- Sump Pump & Lift Station -->
        <div class="calc-section">
          <h3>Sump Pump & Lift Station</h3>
          <p class="code-reference">Reference: IPC Section 712; RNPCP 2021 Section 1201</p>
          
          <div class="form-row">
            <label>Sump Volume:</label>
            <div class="input-group">
              <input id="sumpVolume" type="number" min="0" value="2000">
              <div class="unit">L</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Emptying Time:</label>
            <div class="input-group">
              <input id="sumpTime" type="number" min="0" value="10">
              <div class="unit">min</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Static Head:</label>
            <div class="input-group">
              <input id="sumpHead" type="number" value="8">
              <div class="unit">m</div>
            </div>
          </div>
          
          <button onclick="calculateSumpPump()">Calculate Pump Q & Power</button>
          <div id="sumpPumpOutput" class="output"></div>
        </div>

        <!-- Fire Protection Pump -->
        <div class="calc-section">
          <h3>Fire Protection Pump Sizing</h3>
          <p class="code-reference">Reference: NFPA 14 (2023 ed.); IBC Section 905; BFP Standards</p>
          
          <div class="form-row">
            <label>Required Flow:</label>
            <div class="input-group">
              <input id="firePumpFlow" type="number" min="0" value="32">
              <div class="unit">L/s</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Total Dynamic Head:</label>
            <div class="input-group">
              <input id="firePumpTDH" type="number" min="0" value="45">
              <div class="unit">m</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Pump Efficiency:</label>
            <div class="input-group">
              <input id="firePumpEfficiency" type="number" min="0" max="100" value="70">
              <div class="unit">%</div>
            </div>
          </div>
          
          <button onclick="calculateFirePump()">Calculate Pump Power</button>
          <div id="firePumpOutput" class="output"></div>
        </div>

        <!-- Rainwater Pump Sizing -->
        <div class="calc-section">
          <h3>Rainwater Pump Sizing</h3>
          
          <div class="form-row">
            <label>Required Flow:</label>
            <div class="input-group">
              <input id="rainPumpFlow" type="number" min="0" value="3">
              <div class="unit">L/s</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Total Dynamic Head:</label>
            <div class="input-group">
              <input id="rainPumpTDH" type="number" min="0" value="25">
              <div class="unit">m</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Pump Efficiency:</label>
            <div class="input-group">
              <input id="rainPumpEfficiency" type="number" min="0" max="100" value="70">
              <div class="unit">%</div>
            </div>
          </div>
          
          <button onclick="calculateRainwaterPump()">Calculate Pump Power</button>
          <div id="rainwaterPumpOutput" class="output"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Special Systems & Reference -->
  <div id="special-systems" class="tab-content">
    <div class="section">
      <h2>Special Systems & Code References</h2>
      
      <div class="calculator-grid">
        <!-- Fire Protection / Standpipe -->
        <div class="calc-section">
          <h3>Fire Protection — Standpipe</h3>
          <p class="code-reference">Reference: IBC Section 905; NFPA 14 (2023 ed.); RNPCP 2021 & BFP Standards</p>
          
          <div class="form-row">
            <label>Number of Standpipes:</label>
            <div class="input-group">
              <input id="standpipeCount" type="number" min="0" value="2">
            </div>
          </div>
          
          <div class="form-row">
            <label>Flow per Standpipe:</label>
            <div class="input-group">
              <input id="standpipeFlow" type="number" min="0" value="32">
              <div class="unit">L/s</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Duration:</label>
            <div class="input-group">
              <input id="standpipeDuration" type="number" min="0" value="60">
              <div class="unit">min</div>
            </div>
          </div>
          
          <button onclick="calculateFireDemand()">Calculate Fire Demand</button>
          <div id="fireDemandOutput" class="output"></div>
        </div>

        <!-- Rainwater Tank Sizing -->
        <div class="calc-section">
          <h3>Rainwater Tank Sizing</h3>
          <p class="code-reference">Reference: IPC Section 1301; RNPCP 2021 Section 613; PGBC (2015)</p>
          
          <div class="form-row">
            <label>Roof Area:</label>
            <div class="input-group">
              <input id="rainRoofArea" type="number" min="0" value="300">
              <div class="unit">m²</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Annual Rainfall:</label>
            <div class="input-group">
              <input id="rainRainfall" type="number" min="0" value="2000">
              <div class="unit">mm/yr</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Collection Efficiency:</label>
            <div class="input-group">
              <input id="rainEfficiency" type="number" min="0" max="100" value="85">
              <div class="unit">%</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Daily Water Demand:</label>
            <div class="input-group">
              <input id="rainDemand" type="number" min="0" value="5000">
              <div class="unit">L/day</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Storage Duration:</label>
            <div class="input-group">
              <input id="rainDuration" type="number" min="0" value="7">
              <div class="unit">days</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Building Footprint Area:</label>
            <div class="input-group">
              <input id="rainFootprint" type="number" min="0" value="250">
              <div class="unit">m²</div>
            </div>
          </div>
          
          <button onclick="calculateRainwaterTank()">Calculate Tank Size</button>
          <div id="rainwaterTankOutput" class="output"></div>
        </div>

        <!-- STP Design -->
        <div class="calc-section">
          <h3>Sewage Treatment Plant (STP) Design</h3>
          <p class="code-reference">Reference: DENR DAO 2016-08; RNPCP 2021 Section 1201</p>
          
          <div class="form-row">
            <label>Daily Wastewater Flow:</label>
            <div class="input-group">
              <input id="stpFlow" type="number" min="0" value="50">
              <div class="unit">m³/day</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>BOD5 Influent:</label>
            <div class="input-group">
              <input id="stpBOD" type="number" min="0" value="250">
              <div class="unit">mg/L</div>
            </div>
          </div>
          
          <div class="form-row">
            <label>Treatment Type:</label>
            <div class="input-group">
              <select id="stpTreatment">
                <option value="mbbr">MBBR (Moving Bed Biofilm Reactor)</option>
                <option value="mbr">MBR (Membrane Bioreactor)</option>
                <option value="sbr">SBR (Sequencing Batch Reactor)</option>
              </select>
            </div>
          </div>
          
          <button onclick="calculateSTPVolume()">Calculate STP Volume</button>
          <div id="stpVolumeOutput" class="output"></div>
        </div>

        <!-- DFU Tables -->
        <div class="calc-section">
          <h3>Drainage Fixture Unit (DFU) Tables</h3>
          <p class="code-reference">Reference: IPC Table 709.1 (2024 ed.); RNPCP 2021 Table 7-3</p>
          
          <h4>IPC 2024 DFU Table</h4>
          <table class="reference-table">
            <thead><tr><th>Fixture</th><th>DFU (Private)</th><th>DFU (Public)</th></tr></thead>
            <tbody>
              <tr><td>Toilet (1.6 gpf)</td><td>3</td><td>4</td></tr>
              <tr><td>Lavatory</td><td>1</td><td>1</td></tr>
              <tr><td>Bath/Shower</td><td>2</td><td>2</td></tr>
              <tr><td>Kitchen sink</td><td>2</td><td>2</td></tr>
              <tr><td>Floor drain (2" min)</td><td>2</td><td>2</td></tr>
            </tbody>
          </table>
          
          <h4>RNPCP 2021 DFU Table</h4>
          <table class="reference-table">
            <thead><tr><th>Fixture</th><th>DFU (Private)</th><th>DFU (Public)</th></tr></thead>
            <tbody>
              <tr><td>Water closet</td><td>4</td><td>6</td></tr>
              <tr><td>Lavatory</td><td>1</td><td>1</td></tr>
              <tr><td>Bathtubs</td><td>2</td><td>2</td></tr>
              <tr><td>Kitchen sink</td><td>2</td><td>2</td></tr>
              <tr><td>Floor drains</td><td>2</td><td>2</td></tr>
              <tr><td>Shower (single head)</td><td>2</td><td>2</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="button-group" style="margin-top: 20px;">
        <button onclick="generateDesignSummary()">Generate Design Summary</button>
        <button class="secondary" onclick="exportDesignToPDF()">Export to PDF</button>
        <button class="secondary" onclick="exportDesignToExcel()">Export to Excel</button>
      </div>
      
      <div id="designSummaryOutput" class="output"></div>
    </div>
  </div>

</div>

<script>
// Global state
let designResults = {};

// Tab functionality
document.querySelectorAll('.tab').forEach(t=>{
    t.addEventListener('click', function(){
        const tab = this.getAttribute('data-tab');
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        this.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(tc=>tc.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
    });
});

// Utility functions
function safeNumber(v, fallback=0) {
    const n = Number(v);
    if (isNaN(n)) return fallback;
    return n;
}

function formatNumber(num, dp=2) {
    if (typeof num !== 'number' || isNaN(num)) return '';
    const rounded = Math.round((num+Number.EPSILON)*Math.pow(10,dp))/Math.pow(10,dp);
    return rounded.toLocaleString(undefined, {minimumFractionDigits: dp, maximumFractionDigits: dp});
}

// Water System Design Calculations
function calculateWaterSupply() {
    const fixtureUnits = safeNumber(document.getElementById('waterFixtureUnits').value, 50);
    const peakFactor = safeNumber(document.getElementById('waterPeakFactor').value, 0.7);
    const supplyPressure = safeNumber(document.getElementById('waterSupplyPressure').value, 30);
    const minPressure = safeNumber(document.getElementById('waterMinPressure').value, 15);
    
    // Simplified flow calculation
    const peakFlow = fixtureUnits * peakFactor * 0.028; // L/s approximation
    
    // Pipe sizing logic (simplified)
    let recommendedPipe = "";
    if (peakFlow < 1.5) recommendedPipe = "15 mm (1/2\")";
    else if (peakFlow < 3.0) recommendedPipe = "20 mm (3/4\")";
    else if (peakFlow < 6.0) recommendedPipe = "25 mm (1\")";
    else if (peakFlow < 12.0) recommendedPipe = "32 mm (1 1/4\")";
    else recommendedPipe = "40 mm (1 1/2\") or larger";
    
    const output = document.getElementById('waterSupplyOutput');
    output.innerHTML = `
        <h4>Water Supply Results</h4>
        <p><strong>Peak Flow:</strong> ${formatNumber(peakFlow, 2)} L/s</p>
        <p><strong>Recommended Pipe Size:</strong> ${recommendedPipe}</p>
        <p><strong>Available Pressure Head:</strong> ${formatNumber(supplyPressure - (minPressure * 0.7), 1)} m</p>
        <p class="code-reference">Max velocity: 0.6–2.4 m/s (IPC) or 1.5-2.5 m/s (RNPCP 2021)</p>
    `;
    output.style.display = 'block';
    
    designResults.waterSupply = {
        peakFlow,
        recommendedPipe,
        availableHead: supplyPressure - (minPressure * 0.7)
    };
}

function calculateTankSize() {
    const population = safeNumber(document.getElementById('tankPopulation').value, 100);
    const dailyDemand = safeNumber(document.getElementById('tankDailyDemand').value, 180);
    const emergencyDays = safeNumber(document.getElementById('tankEmergencyDays').value, 2);
    const fireReserve = safeNumber(document.getElementById('tankFireReserve').value, 5000);
    const equalization = safeNumber(document.getElementById('tankEqualization').value, 20) / 100;
    
    const dailyVolume = population * dailyDemand;
    const emergencyStorage = dailyVolume * emergencyDays;
    const equalizationStorage = dailyVolume * equalization;
    const totalVolume = emergencyStorage + fireReserve + equalizationStorage;
    
    const output = document.getElementById('tankSizeOutput');
    output.innerHTML = `
        <h4>Water Tank Sizing Results</h4>
        <p><strong>Daily Demand:</strong> ${formatNumber(dailyVolume)} L</p>
        <p><strong>Emergency Storage (${emergencyDays} days):</strong> ${formatNumber(emergencyStorage)} L</p>
        <p><strong>Fire Reserve:</strong> ${formatNumber(fireReserve)} L</p>
        <p><strong>Equalization Storage (${equalization*100}%):</strong> ${formatNumber(equalizationStorage)} L</p>
        <p><strong>Total Tank Volume:</strong> ${formatNumber(totalVolume)} L (${formatNumber(totalVolume/1000, 1)} m³)</p>
        <p class="code-reference">Consider dual tanks for maintenance redundancy per RNPCP 2021</p>
    `;
    output.style.display = 'block';
    
    designResults.tankSize = {
        dailyVolume,
        emergencyStorage,
        fireReserve,
        equalizationStorage,
        totalVolume
    };
}

function calculateBoosterPump() {
    const flow = safeNumber(document.getElementById('pumpFlow').value, 5);
    const elevation = safeNumber(document.getElementById('pumpElevation').value, 15);
    const friction = safeNumber(document.getElementById('pumpFriction').value, 8);
    const safety = safeNumber(document.getElementById('pumpSafety').value, 15) / 100;
    const efficiency = safeNumber(document.getElementById('pumpEfficiency').value, 75) / 100;
    
    const tdh = (elevation + friction) * (1 + safety);
    const power = (flow * tdh * 9.81) / (efficiency * 1000); // kW
    
    const output = document.getElementById('boosterPumpOutput');
    output.innerHTML = `
        <h4>Booster Pump Results</h4>
        <p><strong>Total Dynamic Head (TDH):</strong> ${formatNumber(tdh, 1)} m</p>
        <p><strong>Required Power:</strong> ${formatNumber(power, 2)} kW</p>
        <p><strong>Motor Size (approx):</strong> ${formatNumber(power * 1.25, 2)} kW (with 25% safety)</p>
        <p class="code-reference">Ensure min pressure (15 psi) at highest fixture per RNPCP 2021</p>
    `;
    output.style.display = 'block';
    
    designResults.boosterPump = {
        tdh,
        power,
        motorSize: power * 1.25
    };
}

function calculateHotWaterDemand() {
    const bathrooms = safeNumber(document.getElementById('hotWaterBathrooms').value, 10);
    const simultaneous = safeNumber(document.getElementById('hotWaterSimultaneous').value, 15) / 100;
    const hotFraction = safeNumber(document.getElementById('hotWaterFraction').value, 0.6);
    
    const peakFlow = bathrooms * simultaneous * 0.2 * hotFraction; // L/s approximation
    
    const output = document.getElementById('hotWaterOutput');
    output.innerHTML = `
        <h4>Hot Water Demand Results</h4>
        <p><strong>Peak Hot Water Flow:</strong> ${formatNumber(peakFlow, 2)} L/s</p>
        <p><strong>Recommended Heater Capacity:</strong> ${formatNumber(peakFlow * 60 * 15, 0)} L (15-minute storage)</p>
        <p class="code-reference">Size heater for recovery capacity based on usage pattern per RNPCP 2021</p>
    `;
    output.style.display = 'block';
    
    designResults.hotWater = {
        peakFlow,
        heaterCapacity: peakFlow * 60 * 15
    };
}

// Drainage Calculations
function calculateSewerLoad() {
    const population = safeNumber(document.getElementById('sewerPopulation').value, 100);
    const perCapita = safeNumber(document.getElementById('sewerPerCapita').value, 120);
    
    const dailyFlow = population * perCapita;
    
    const output = document.getElementById('sewerLoadOutput');
    output.innerHTML = `
        <h4>Sanitary Sewer Results</h4>
        <p><strong>Daily Wastewater Flow:</strong> ${formatNumber(dailyFlow)} L/day</p>
        <p><strong>Average Flow:</strong> ${formatNumber(dailyFlow / 86400 * 1000, 2)} L/s</p>
        <p class="code-reference">Peak flow typically 3-5x average flow per RNPCP 2021</p>
    `;
    output.style.display = 'block';
    
    designResults.sewerLoad = {
        dailyFlow,
        averageFlow: dailyFlow / 86400 * 1000
    };
}

function calculateDFUFlow() {
    const dfu = safeNumber(document.getElementById('sewerDFU').value, 85);
    
    // Approximation: Peak flow (L/s) ≈ 0.0017 × DFU^0.6 × 1000/3600
    const peakFlow = 0.0017 * Math.pow(dfu, 0.6) * 1000/3600;
    
    const output = document.getElementById('dfuFlowOutput');
    output.innerHTML = `
        <h4>DFU to Flow Conversion</h4>
        <p><strong>Peak Flow from ${dfu} DFU:</strong> ${formatNumber(peakFlow, 2)} L/s</p>
        <p class="code-reference">Use code tables (IPC Table 709.3 or RNPCP 2021 Table 7-5) for precise values</p>
    `;
    output.style.display = 'block';
}

function calculateStormFlow() {
    const coefficient = safeNumber(document.getElementById('stormCoefficient').value, 0.8);
    const intensity = safeNumber(document.getElementById('stormIntensity').value, 120);
    const area = safeNumber(document.getElementById('stormArea').value, 500);
    
    const peakFlow = coefficient * intensity * area / 3600; // L/s
    
    const output = document.getElementById('stormFlowOutput');
    output.innerHTML = `
        <h4>Storm Drainage Results</h4>
        <p><strong>Peak Runoff Flow:</strong> ${formatNumber(peakFlow, 2)} L/s</p>
        <p><strong>Recommended Pipe Size:</strong> ${getPipeSizeFromFlow(peakFlow)}</p>
        <p class="code-reference">Q = C × i × A (Rational Method) - RNPCP 2021 Section 1102</p>
    `;
    output.style.display = 'block';
    
    designResults.stormFlow = {
        peakFlow,
        pipeSize: getPipeSizeFromFlow(peakFlow)
    };
}

function calculateSepticTank() {
    const dailyFlow = safeNumber(document.getElementById('septicDailyFlow').value, 12000);
    const retention = safeNumber(document.getElementById('septicRetention').value, 36);
    const freeboard = safeNumber(document.getElementById('septicFreeboard').value, 20) / 100;
    const compartments = safeNumber(document.getElementById('septicCompartments').value, 2);
    
    const volume = dailyFlow * (retention / 24) * (1 + freeboard);
    
    const output = document.getElementById('septicTankOutput');
    output.innerHTML = `
        <h4>Septic Tank Results</h4>
        <p><strong>Required Volume:</strong> ${formatNumber(volume)} L (${formatNumber(volume/1000, 1)} m³)</p>
        <p><strong>Compartments:</strong> ${compartments}</p>
        <p><strong>Compartment Sizes:</strong> ${formatNumber(volume/compartments)} L each</p>
        <p class="code-reference">Minimum sizes per RNPCP 2021 and DOH standards</p>
    `;
    output.style.display = 'block';
    
    designResults.septicTank = {
        volume,
        compartments,
        compartmentSize: volume/compartments
    };
}

function calculateGreaseTrap() {
    const peakFlow = safeNumber(document.getElementById('greasePeakFlow').value, 2);
    const retention = safeNumber(document.getElementById('greaseRetention').value, 25);
    
    const volume = peakFlow * retention * 60; // L
    
    const output = document.getElementById('greaseTrapOutput');
    output.innerHTML = `
        <h4>Grease Trap Results</h4>
        <p><strong>Required Volume:</strong> ${formatNumber(volume)} L</p>
        <p><strong>Recommended:</strong> Dual compartment grease interceptor</p>
        <p class="code-reference">Minimum retention requirements per RNPCP 2021 Section 1011</p>
    `;
    output.style.display = 'block';
    
    designResults.greaseTrap = {
        volume
    };
}

// Pump System Calculations
function calculateTransferPump() {
    const flow = safeNumber(document.getElementById('transferFlow').value, 8);
    const lift = safeNumber(document.getElementById('transferLift').value, 12);
    const friction = safeNumber(document.getElementById('transferFriction').value, 5);
    const efficiency = safeNumber(document.getElementById('transferEfficiency').value, 75) / 100;
    const safety = safeNumber(document.getElementById('transferSafety').value, 10) / 100;
    
    const tdh = (lift + friction) * (1 + safety);
    const power = (flow * tdh * 9.81) / (efficiency * 1000);
    
    const output = document.getElementById('transferPumpOutput');
    output.innerHTML = `
        <h4>Transfer Pump Results</h4>
        <p><strong>Total Dynamic Head:</strong> ${formatNumber(tdh, 1)} m</p>
        <p><strong>Required Power:</strong> ${formatNumber(power, 2)} kW</p>
        <p><strong>Motor Size:</strong> ${formatNumber(power * 1.25, 2)} kW</p>
    `;
    output.style.display = 'block';
    
    designResults.transferPump = {
        tdh,
        power,
        motorSize: power * 1.25
    };
}

function calculateSumpPump() {
    const volume = safeNumber(document.getElementById('sumpVolume').value, 2000);
    const time = safeNumber(document.getElementById('sumpTime').value, 10);
    const head = safeNumber(document.getElementById('sumpHead').value, 8);
    
    const flow = volume / (time * 60); // L/s
    const power = (flow * head * 9.81) / (0.7 * 1000); // Assuming 70% efficiency
    
    const output = document.getElementById('sumpPumpOutput');
    output.innerHTML = `
        <h4>Sump Pump Results</h4>
        <p><strong>Required Flow:</strong> ${formatNumber(flow, 2)} L/s</p>
        <p><strong>Required Power:</strong> ${formatNumber(power, 2)} kW</p>
        <p><strong>Recommended:</strong> Submersible sump pump with float switch</p>
    `;
    output.style.display = 'block';
    
    designResults.sumpPump = {
        flow,
        power
    };
}

function calculateFirePump() {
    const flow = safeNumber(document.getElementById('firePumpFlow').value, 32);
    const tdh = safeNumber(document.getElementById('firePumpTDH').value, 45);
    const efficiency = safeNumber(document.getElementById('firePumpEfficiency').value, 70) / 100;
    
    const power = (flow * tdh * 9.81) / (efficiency * 1000);
    
    const output = document.getElementById('firePumpOutput');
    output.innerHTML = `
        <h4>Fire Pump Results</h4>
        <p><strong>Required Power:</strong> ${formatNumber(power, 2)} kW</p>
        <p><strong>Recommended:</strong> Centrifugal fire pump with diesel backup</p>
        <p class="code-reference">Validate with NFPA 14 (2023) and BFP standards for redundancy</p>
    `;
    output.style.display = 'block';
    
    designResults.firePump = {
        power
    };
}

function calculateRainwaterPump() {
    const flow = safeNumber(document.getElementById('rainPumpFlow').value, 3);
    const tdh = safeNumber(document.getElementById('rainPumpTDH').value, 25);
    const efficiency = safeNumber(document.getElementById('rainPumpEfficiency').value, 70) / 100;
    
    const power = (flow * tdh * 9.81) / (efficiency * 1000);
    
    const output = document.getElementById('rainwaterPumpOutput');
    output.innerHTML = `
        <h4>Rainwater Pump Results</h4>
        <p><strong>Required Power:</strong> ${formatNumber(power, 2)} kW</p>
        <p><strong>Recommended:</strong> Submersible or centrifugal pump with screen/filter</p>
    `;
    output.style.display = 'block';
    
    designResults.rainwaterPump = {
        power
    };
}

// Special Systems Calculations
function calculateFireDemand() {
    const count = safeNumber(document.getElementById('standpipeCount').value, 2);
    const flowPer = safeNumber(document.getElementById('standpipeFlow').value, 32);
    const duration = safeNumber(document.getElementById('standpipeDuration').value, 60);
    
    const totalFlow = count === 1 ? flowPer : flowPer + (count - 1) * 16;
    const totalVolume = totalFlow * duration * 60;
    
    const output = document.getElementById('fireDemandOutput');
    output.innerHTML = `
        <h4>Fire Protection Results</h4>
        <p><strong>Total Flow:</strong> ${formatNumber(totalFlow, 2)} L/s</p>
        <p><strong>Total Volume:</strong> ${formatNumber(totalVolume)} L</p>
        ${totalFlow > 79 ? '<p style="color: var(--danger)"><strong>Warning:</strong> Exceeds 79 L/s limit for ordinary hazard</p>' : ''}
        <p class="code-reference">Pressure: 100 psi at outlet per NFPA 14 (2023) and RNPCP 2021</p>
    `;
    output.style.display = 'block';
    
    designResults.fireDemand = {
        totalFlow,
        totalVolume
    };
}

function calculateRainwaterTank() {
    const roofArea = safeNumber(document.getElementById('rainRoofArea').value, 300);
    const rainfall = safeNumber(document.getElementById('rainRainfall').value, 2000);
    const efficiency = safeNumber(document.getElementById('rainEfficiency').value, 85) / 100;
    const demand = safeNumber(document.getElementById('rainDemand').value, 5000);
    const duration = safeNumber(document.getElementById('rainDuration').value, 7);
    const footprint = safeNumber(document.getElementById('rainFootprint').value, 250);
    
    const annualCollection = (roofArea * rainfall * efficiency) / 1000;
    const demandVolume = demand * duration;
    const calculatedVolume = Math.max(annualCollection * 1000 - demandVolume, 0);
    const pgbcMinimum = (footprint / 75) * 1000;
    const recommendedVolume = Math.max(calculatedVolume, pgbcMinimum);
    
    const output = document.getElementById('rainwaterTankOutput');
    output.innerHTML = `
        <h4>Rainwater Tank Results</h4>
        <p><strong>Annual Collection:</strong> ${formatNumber(annualCollection, 1)} m³</p>
        <p><strong>Calculated Volume:</strong> ${formatNumber(calculatedVolume)} L</p>
        <p><strong>PGBC Minimum:</strong> ${formatNumber(pgbcMinimum)} L</p>
        <p><strong>Recommended Tank Volume:</strong> ${formatNumber(recommendedVolume)} L</p>
        ${calculatedVolume < pgbcMinimum ? '<p style="color: var(--warning)"><strong>Note:</strong> Calculated volume below PGBC minimum</p>' : ''}
    `;
    output.style.display = 'block';
    
    designResults.rainwaterTank = {
        annualCollection,
        calculatedVolume,
        pgbcMinimum,
        recommendedVolume
    };
}

function calculateSTPVolume() {
    const flow = safeNumber(document.getElementById('stpFlow').value, 50);
    const treatmentType = document.getElementById('stpTreatment').value;
    
    let hrt = 0;
    switch (treatmentType) {
        case 'mbbr': hrt = 6; break;
        case 'mbr': hrt = 4; break;
        case 'sbr': hrt = 12; break;
    }
    
    const volume = flow * hrt;
    
    const output = document.getElementById('stpVolumeOutput');
    output.innerHTML = `
        <h4>STP Design Results</h4>
        <p><strong>Recommended STP Volume:</strong> ${formatNumber(volume, 1)} m³</p>
        <p><strong>Treatment Type:</strong> ${treatmentType.toUpperCase()}</p>
        <p><strong>Hydraulic Retention Time:</strong> ${hrt} hours</p>
        <p class="code-reference">Include aerators, blowers, and disinfection systems per RNPCP 2021</p>
    `;
    output.style.display = 'block';
    
    designResults.stpVolume = {
        volume,
        treatmentType,
        hrt
    };
}

// Helper function for pipe sizing
function getPipeSizeFromFlow(flow) {
    if (flow < 2) return "100 mm (4\")";
    if (flow < 5) return "150 mm (6\")";
    if (flow < 10) return "200 mm (8\")";
    if (flow < 20) return "250 mm (10\")";
    return "300 mm (12\") or larger";
}

// Summary and Export Functions
function generateDesignSummary() {
    let summary = "<h3>Design Summary</h3>";
    
    for (const [category, results] of Object.entries(designResults)) {
        summary += `<h4>${category.replace(/([A-Z])/g, ' $1').toUpperCase()}</h4>`;
        summary += "<ul>";
        for (const [key, value] of Object.entries(results)) {
            const displayKey = key.replace(/([A-Z])/g, ' $1');
            summary += `<li><strong>${displayKey}:</strong> ${typeof value === 'number' ? formatNumber(value) : value}</li>`;
        }
        summary += "</ul>";
    }
    
    const output = document.getElementById('designSummaryOutput');
    output.innerHTML = summary;
    output.style.display = 'block';
}

function exportDesignToPDF() {
    if (Object.keys(designResults).length === 0) {
        alert('Please run some calculations first.');
        return;
    }

    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ unit: 'pt', format: 'a4' });
        
        doc.setFont('helvetica');
        doc.setFontSize(16);
        doc.setFont('helvetica', 'bold');
        doc.text("Plumbing & Sanitary Design Report", 40, 40);
        
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.text(`Project: ${document.getElementById('projectName').value}`, 40, 70);
        doc.text(`Date: ${new Date().toLocaleDateString()}`, 40, 85);
        
        let y = 120;
        
        for (const [category, results] of Object.entries(designResults)) {
            if (y > 700) {
                doc.addPage();
                y = 40;
            }
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.text(category.replace(/([A-Z])/g, ' $1').toUpperCase(), 40, y);
            y += 20;
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            
            for (const [key, value] of Object.entries(results)) {
                const displayKey = key.replace(/([A-Z])/g, ' $1');
                doc.text(`${displayKey}: ${typeof value === 'number' ? formatNumber(value) : value}`, 60, y);
                y += 15;
                
                if (y > 750) {
                    doc.addPage();
                    y = 40;
                }
            }
            
            y += 10;
        }
        
        const safeName = (document.getElementById('projectName').value||'project').replace(/[^a-z0-9]/gi,'_');
        doc.save(`${safeName}_plumbing_design_report.pdf`);
        
    } catch (err) {
        console.error(err);
        alert('Error generating PDF: ' + err.message);
    }
}

function exportDesignToExcel() {
    if (Object.keys(designResults).length === 0) {
        alert('Please run some calculations first.');
        return;
    }

    try {
        const wb = XLSX.utils.book_new();
        const wsData = [['Category', 'Parameter', 'Value', 'Units']];
        
        for (const [category, results] of Object.entries(designResults)) {
            for (const [key, value] of Object.entries(results)) {
                const displayKey = key.replace(/([A-Z])/g, ' $1');
                wsData.push([category, displayKey, value, '']);
            }
        }
        
        const ws = XLSX.utils.aoa_to_sheet(wsData);
        XLSX.utils.book_append_sheet(wb, ws, 'Design Summary');
        
        const safeName = document.getElementById('projectName').value.replace(/[^a-z0-9]/gi, '_');
        XLSX.writeFile(wb, `${safeName}_plumbing_design.xlsx`);
        
    } catch (err) {
        console.error(err);
        alert('Error generating Excel file: ' + err.message);
    }
}

// Project Management Functions
function saveProjectAsJSON() {
    const data = {
        projectName: document.getElementById('projectName').value,
        clientName: document.getElementById('clientName').value,
        projectLocation: document.getElementById('projectLocation').value,
        preparedBy: document.getElementById('preparedBy').value,
        currency: document.getElementById('currency').value,
        codeStandard: document.getElementById('codeStandard').value,
        units: document.getElementById('units').value,
        designResults: designResults
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `${document.getElementById('projectName').value.replace(/[^a-z0-9]/gi, '_')}_plumbing_design.json`;
    a.click();
}

function loadProjectFromJSON(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            
            if (data.projectName) document.getElementById('projectName').value = data.projectName;
            if (data.clientName) document.getElementById('clientName').value = data.clientName;
            if (data.projectLocation) document.getElementById('projectLocation').value = data.projectLocation;
            if (data.preparedBy) document.getElementById('preparedBy').value = data.preparedBy;
            if (data.currency) document.getElementById('currency').value = data.currency;
            if (data.codeStandard) document.getElementById('codeStandard').value = data.codeStandard;
            if (data.units) document.getElementById('units').value = data.units;
            if (data.designResults) designResults = data.designResults;
            
            alert('Project loaded successfully!');
            
        } catch (err) {
            alert('Error loading project: ' + err.message);
        }
    };
    reader.readAsText(file);
}

function resetCalculator() {
    if (!confirm('Reset calculator to defaults?')) return;
    location.reload();
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    // Any initialization code if needed
});
</script>
</body>
</html>
